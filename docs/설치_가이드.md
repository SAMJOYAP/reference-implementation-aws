# AWS Reference Implementation ì™„ë²½ ì„¤ì¹˜ ê°€ì´ë“œ

> **ğŸ¯ ì´ ê°€ì´ë“œì˜ ëª©í‘œ**: ì²˜ìŒ ì‹œì‘í•˜ëŠ” ì‚¬ìš©ìê°€ í•œ ë²ˆì— ì„±ê³µì ìœ¼ë¡œ í”Œë«í¼ì„ êµ¬ì¶•í•  ìˆ˜ ìˆë„ë¡ ëª¨ë“  ë‹¨ê³„ë¥¼ ìƒì„¸íˆ ì•ˆë‚´í•©ë‹ˆë‹¤.

## ğŸ“‹ ëª©ì°¨

1. [ê°œìš”](#1-ê°œìš”)
2. [ì‚¬ì „ ì¤€ë¹„ì‚¬í•­](#2-ì‚¬ì „-ì¤€ë¹„ì‚¬í•­)
3. [GitHub ì„¤ì •](#3-github-ì„¤ì •)
4. [AWS ì„¤ì •](#4-aws-ì„¤ì •)
5. [ì„¤ì • íŒŒì¼ ì‘ì„±](#5-ì„¤ì •-íŒŒì¼-ì‘ì„±)
6. [EKS í´ëŸ¬ìŠ¤í„° ìƒì„±](#6-eks-í´ëŸ¬ìŠ¤í„°-ìƒì„±)
7. [í”Œë«í¼ ì„¤ì¹˜](#7-í”Œë«í¼-ì„¤ì¹˜)
8. [ì ‘ì† ë° í™•ì¸](#8-ì ‘ì†-ë°-í™•ì¸)
9. [íŠ¸ëŸ¬ë¸”ìŠˆíŒ…](#9-íŠ¸ëŸ¬ë¸”ìŠˆíŒ…)
10. [ìš´ì˜ ê°€ì´ë“œ](#10-ìš´ì˜-ê°€ì´ë“œ)

---

## 1. ê°œìš”

### 1.1 ì„¤ì¹˜ë˜ëŠ” ì»´í¬ë„ŒíŠ¸

| ì»´í¬ë„ŒíŠ¸ | ë„¤ì„ìŠ¤í˜ì´ìŠ¤ | ìš©ë„ | ì°¨íŠ¸ ë²„ì „ |
|---------|------------|------|----------|
| **Argo CD** | argocd | GitOps ë°°í¬ ê´€ë¦¬ | 8.0.14 |
| **Backstage** | backstage | ê°œë°œì í¬í„¸ (ì…€í”„ì„œë¹„ìŠ¤) | 2.6.0 |
| **Keycloak** | keycloak | í†µí•© ì¸ì¦/ì¸ê°€ (SSO) | 24.7.3 |
| **Crossplane** | crossplane-system | Infrastructure as Code | 1.20.0 |
| **External Secrets** | external-secrets | AWS Secrets Manager ì—°ë™ | 0.17.0 |
| **Cert Manager** | cert-manager | Let's Encrypt SSL ì¸ì¦ì„œ | 1.17.2 |
| **External DNS** | external-dns | Route53 DNS ìë™ ê´€ë¦¬ | 1.16.1 |
| **Ingress NGINX** | ingress-nginx | L7 íŠ¸ë˜í”½ ë¼ìš°íŒ… | 4.7.0 |
| **Argo Workflows** | argo | CI/CD ì›Œí¬í”Œë¡œìš° ì—”ì§„ | 0.45.18 |

### 1.2 ì•„í‚¤í…ì²˜ ê°œìš”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Internet / Users                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ HTTPS
                         â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚   Route 53   â”‚  â† External DNSê°€ ìë™ ê´€ë¦¬
                  â”‚  (your-domain)â”‚
                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Application Load    â”‚  â† AWS LB Controllerê°€ ìƒì„±
              â”‚     Balancer (ALB)   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Ingress NGINX       â”‚  â† Path-based ë¼ìš°íŒ…
              â”‚  (nginx controller)  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼               â–¼               â–¼              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚Backstageâ”‚    â”‚Argo CD  â”‚    â”‚Keycloakâ”‚   â”‚Argo       â”‚
    â”‚         â”‚    â”‚         â”‚    â”‚  (SSO) â”‚   â”‚Workflows  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 ì˜ˆìƒ ì†Œìš” ì‹œê°„

- **ì‚¬ì „ ì¤€ë¹„**: 20-30ë¶„ (ë„êµ¬ ì„¤ì¹˜, GitHub Apps ìƒì„±)
- **EKS í´ëŸ¬ìŠ¤í„° ìƒì„±**: 15-20ë¶„
- **í”Œë«í¼ ì„¤ì¹˜**: 10-15ë¶„
- **DNS ì „íŒŒ ë° ì¸ì¦ì„œ ë°œê¸‰**: 5-10ë¶„
- **ì´**: ì•½ 50-75ë¶„

---

## 2. ì‚¬ì „ ì¤€ë¹„ì‚¬í•­

### 2.1 í•„ìˆ˜ ë„êµ¬ ì„¤ì¹˜

#### macOS

```bash
# Homebrew ì„¤ì¹˜ (ì—†ë‹¤ë©´)
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# í•„ìˆ˜ ë„êµ¬ ì„¤ì¹˜
brew install awscli kubectl eksctl helm yq jq gh
```

#### Linux (Ubuntu/Debian)

```bash
# AWS CLI
curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
unzip awscliv2.zip
sudo ./aws/install

# kubectl
curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"
sudo install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl

# eksctl
curl --silent --location "https://github.com/weaveworks/eksctl/releases/latest/download/eksctl_$(uname -s)_amd64.tar.gz" | tar xz -C /tmp
sudo mv /tmp/eksctl /usr/local/bin

# helm
curl https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash

# yq
sudo wget https://github.com/mikefarah/yq/releases/latest/download/yq_linux_amd64 -O /usr/bin/yq
sudo chmod +x /usr/bin/yq

# jq
sudo apt-get update && sudo apt-get install -y jq

# GitHub CLI
type -p curl >/dev/null || (sudo apt update && sudo apt install curl -y)
curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg | sudo dd of=/usr/share/keyrings/githubcli-archive-keyring.gpg
sudo chmod go+r /usr/share/keyrings/githubcli-archive-keyring.gpg
echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main" | sudo tee /etc/apt/sources.list.d/github-cli.list > /dev/null
sudo apt update
sudo apt install gh -y
```

#### ì„¤ì¹˜ í™•ì¸

```bash
# ëª¨ë“  ë„êµ¬ ë²„ì „ í™•ì¸
aws --version        # AWS CLI 2.x ì´ìƒ
kubectl version --client  # 1.28 ì´ìƒ ê¶Œì¥
eksctl version       # 0.150 ì´ìƒ ê¶Œì¥
helm version         # 3.12 ì´ìƒ ê¶Œì¥
yq --version         # v4.x ì´ìƒ
jq --version         # 1.6 ì´ìƒ
gh --version         # 2.x ì´ìƒ
```

### 2.2 AWS ê³„ì • ì¤€ë¹„

#### í•„ìˆ˜ ê¶Œí•œ

ë‹¤ìŒ AWS ì„œë¹„ìŠ¤ì— ëŒ€í•œ ê´€ë¦¬ì ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤:

- âœ… EC2 (VPC, ì„œë¸Œë„·, ë³´ì•ˆ ê·¸ë£¹, NAT Gateway)
- âœ… EKS (í´ëŸ¬ìŠ¤í„°, ë…¸ë“œ ê·¸ë£¹)
- âœ… IAM (ì—­í• , ì •ì±…, OIDC Provider)
- âœ… Route53 (Hosted Zone, ë ˆì½”ë“œ)
- âœ… Secrets Manager (ì‹œí¬ë¦¿ ìƒì„±/ì½ê¸°)
- âœ… CloudFormation (ìŠ¤íƒ ìƒì„±/ì‚­ì œ)

#### AWS CLI ì„¤ì •

```bash
# AWS Profile ìƒì„±
aws configure --profile your-project-name

# ì…ë ¥ ì˜ˆì‹œ:
# AWS Access Key ID: AKIA2KXJPINW46XXXXXX
# AWS Secret Access Key: kV5OYju45KK751pEuZXXXXXXXXXXXXXXXXXXXX
# Default region name: ap-northeast-2
# Default output format: json

# Profile ì„¤ì • í™•ì¸
export AWS_PROFILE=your-project-name
aws sts get-caller-identity

# ì¶œë ¥ ì˜ˆì‹œ:
# {
#     "UserId": "AIDAXXXXXXXXX",
#     "Account": "123456789012",
#     "Arn": "arn:aws:iam::123456789012:user/your-username"
# }
```

### 2.3 Route53 Hosted Zone ì¤€ë¹„

#### ë„ë©”ì¸ì´ ìˆëŠ” ê²½ìš°

1. Route53 ì½˜ì†”ì—ì„œ Hosted Zone ìƒì„±
2. ë„ë©”ì¸ ë“±ë¡ ì—…ì²´ì—ì„œ ë„¤ì„ì„œë²„ ë³€ê²½

#### í…ŒìŠ¤íŠ¸ìš© ë„ë©”ì¸ì´ í•„ìš”í•œ ê²½ìš°

```bash
# Route53ì—ì„œ ë„ë©”ì¸ êµ¬ë§¤ (ì„ íƒì‚¬í•­)
# ì•½ $12-20/ë…„ (ë„ë©”ì¸ì— ë”°ë¼ ë‹¤ë¦„)
```

#### Hosted Zone ID í™•ì¸

```bash
# Hosted Zone ëª©ë¡ ì¡°íšŒ
aws route53 list-hosted-zones --query 'HostedZones[*].[Name,Id]' --output table

# ì˜ˆì‹œ ì¶œë ¥:
# -----------------------------------
# |      ListHostedZones           |
# +-------------------------+-------+
# |  example.com.          |  Z00297703HVW1L99K37IL  |
# +-------------------------+-------+

# ID ì €ì¥ (ë‚˜ì¤‘ì— config.yamlì— ì‚¬ìš©)
export HOSTED_ZONE_ID=Z00297703HVW1L99K37IL
export DOMAIN=myapp.example.com  # ì‚¬ìš©í•  ì„œë¸Œë„ë©”ì¸
```

---

## 3. GitHub ì„¤ì •

### 3.1 GitHub Organization ìƒì„±

> **ì¤‘ìš”**: ê°œì¸ ê³„ì •ì´ ì•„ë‹Œ Organizationì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

1. https://github.com/account/organizations/new ì ‘ì†
2. Organization ì´ë¦„ ì…ë ¥ (ì˜ˆ: `my-company`)
3. Contact email ì…ë ¥
4. **Organization type**: Free (ë¬´ë£Œ) ì„ íƒ
5. `Create organization` í´ë¦­

### 3.2 Repository Fork

```bash
# GitHub CLIë¡œ ë¡œê·¸ì¸
gh auth login
# ì„ íƒ: GitHub.com â†’ HTTPS â†’ Yes (web browser)

# Repository Fork
gh repo fork cnoe-io/reference-implementation-aws \
  --org YOUR-ORG-NAME \
  --clone=true \
  --remote=true

# ë””ë ‰í† ë¦¬ ì´ë™
cd reference-implementation-aws

# ì›ê²© ì €ì¥ì†Œ í™•ì¸
git remote -v
# origin    https://github.com/YOUR-ORG/reference-implementation-aws.git
```

### 3.3 GitHub Apps ìƒì„±

Backstageì™€ Argo CDëŠ” GitHub Appsë¥¼ í†µí•´ GitHubê³¼ í†µì‹ í•©ë‹ˆë‹¤.

#### 3.3.1 Backstage GitHub App

**1ë‹¨ê³„: GitHub App ìƒì„±**

```bash
# ë¸Œë¼ìš°ì €ì—ì„œ ì•± ìƒì„± í˜ì´ì§€ ì—´ê¸°
open "https://github.com/organizations/YOUR-ORG-NAME/settings/apps/new"
```

**2ë‹¨ê³„: ê¸°ë³¸ ì •ë³´ ì…ë ¥**

```
GitHub App name: YOUR-ORG-backstage
Homepage URL: https://YOUR-DOMAIN  (ì˜ˆ: https://myapp.example.com)
Callback URL: https://YOUR-DOMAIN/api/auth/github/handler/frame
```

**3ë‹¨ê³„: Webhook ì„¤ì •**

```
â˜ Active  (ì²´í¬ í•´ì œ - ë§¤ìš° ì¤‘ìš”!)
```

> **ì™œ Webhookì„ ë¹„í™œì„±í™”í•˜ë‚˜ìš”?**
>
> - Webhookì„ í™œì„±í™”í•˜ë©´ GitHubê°€ ì´ë²¤íŠ¸ë¥¼ Backstageë¡œ ì‹¤ì‹œê°„ ì „ì†¡
> - í•˜ì§€ë§Œ Backstageê°€ ì™¸ë¶€ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•´ì•¼ í•˜ê³  ì¶”ê°€ ë³´ì•ˆ ì„¤ì • í•„ìš”
> - ë¹„í™œì„±í™”í•´ë„ BackstageëŠ” polling ë°©ì‹ìœ¼ë¡œ ì •ìƒ ì‘ë™
> - ê°„ë‹¨í•œ ì„¤ì •ì„ ìœ„í•´ ë¹„í™œì„±í™” ê¶Œì¥

**4ë‹¨ê³„: Repository Permissions ì„¤ì •**

```
Repository permissions:
  âœ“ Administration: Read and write
  âœ“ Contents: Read and write
  âœ“ Metadata: Read-only (ìë™ ì„ íƒë¨)
  âœ“ Members: Read-only

Organization permissions:
  âœ“ Members: Read-only
  âœ“ Administration: Read-only
```

**5ë‹¨ê³„: Where can this GitHub App be installed?**

```
â—‰ Only on this account
```

**6ë‹¨ê³„: ìƒì„± ë° í‚¤ ë‹¤ìš´ë¡œë“œ**

1. `Create GitHub App` í´ë¦­
2. ìƒì„± ì™„ë£Œ í›„ í˜ì´ì§€ í•˜ë‹¨ìœ¼ë¡œ ì´ë™
3. `Generate a private key` í´ë¦­ â†’ `.pem` íŒŒì¼ ë‹¤ìš´ë¡œë“œ (ì•ˆì „í•œ ê³³ì— ë³´ê´€!)
4. í˜ì´ì§€ ìƒë‹¨ì˜ **App ID**, **Client ID** ë³µì‚¬
5. `Generate a new client secret` í´ë¦­ â†’ Client Secret ë³µì‚¬ (í•œ ë²ˆë§Œ í‘œì‹œë¨!)

**7ë‹¨ê³„: App ì„¤ì¹˜**

1. ì¢Œì¸¡ ì‚¬ì´ë“œë°”ì—ì„œ `Install App` í´ë¦­
2. Organization ì˜†ì˜ `Install` í´ë¦­
3. `All repositories` ì„ íƒ
4. `Install` í´ë¦­

#### 3.3.2 Argo CD GitHub App

**ë™ì¼í•œ ê³¼ì • ë°˜ë³µ (ê¶Œí•œë§Œ ë‹¤ë¦„)**

```bash
# ë¸Œë¼ìš°ì €ì—ì„œ ì•± ìƒì„± í˜ì´ì§€ ì—´ê¸°
open "https://github.com/organizations/YOUR-ORG-NAME/settings/apps/new"
```

**ê¸°ë³¸ ì •ë³´:**
```
GitHub App name: YOUR-ORG-argocd
Homepage URL: https://YOUR-DOMAIN/argocd
Webhook: â˜ Active (ì²´í¬ í•´ì œ)
```

**Repository Permissions (ì½ê¸° ì „ìš©):**
```
Repository permissions:
  âœ“ Contents: Read-only
  âœ“ Metadata: Read-only (ìë™)
```

**ìƒì„± í›„:**
- Private key ë‹¤ìš´ë¡œë“œ
- App ID ë³µì‚¬
- App ì„¤ì¹˜

**Installation ID í™•ì¸:**

```bash
# ë¸Œë¼ìš°ì €ì—ì„œ ë‹¤ìŒ URL ì ‘ì†
open "https://github.com/organizations/YOUR-ORG-NAME/settings/installations"

# URL í™•ì¸: https://github.com/organizations/YOUR-ORG/settings/installations/12345678
# ë§ˆì§€ë§‰ ìˆ«ìê°€ Installation ID
export ARGOCD_INSTALLATION_ID=12345678
```

### 3.4 ìê²© ì¦ëª… íŒŒì¼ ì‘ì„±

#### í…œí”Œë¦¿ ë³µì‚¬

```bash
cd /path/to/reference-implementation-aws

cp private/backstage-github.yaml.template private/backstage-github.yaml
cp private/argocd-github.yaml.template private/argocd-github.yaml
```

#### Backstage ìê²© ì¦ëª… ì‘ì„±

```bash
vi private/backstage-github.yaml
```

**ë‚´ìš© ì‘ì„±:**

```yaml
appId: 2858537  # â† GitHub App í˜ì´ì§€ì—ì„œ í™•ì¸í•œ App ID
webhookUrl: https://myapp.example.com  # â† ì‚¬ìš©í•  ë„ë©”ì¸
clientId: Iv23liZ8FpihlN4O9ebL  # â† Client ID
clientSecret: 7d96e56c52d608bd669a628c1f1873b871122960  # â† Client Secret
webhookSecret: "dummy-webhook-secret-not-used"  # â† ë°˜ë“œì‹œ ì´ ê°’ ì‚¬ìš©!
privateKey: |
  -----BEGIN RSA PRIVATE KEY-----
  MIIEogIBAAKCAQEAv0NKTtTs8Ktp55yFwa7Scf0dND6y+8OMgPemwYxzVtmPMCD/
  ... (ë‹¤ìš´ë¡œë“œí•œ .pem íŒŒì¼ ë‚´ìš© ì „ì²´ ë³µì‚¬)
  ...
  -----END RSA PRIVATE KEY-----
```

> **âš ï¸ ì¤‘ìš”: webhookSecret ê°’**
>
> - **ë°˜ë“œì‹œ** `"dummy-webhook-secret-not-used"` ë¬¸ìì—´ì„ ì‚¬ìš©í•˜ì„¸ìš”
> - ë¹ˆ ë¬¸ìì—´(`""`)ì„ ì‚¬ìš©í•˜ë©´ Backstage podì´ ì‹œì‘ ì‹¤íŒ¨í•©ë‹ˆë‹¤
> - Webhookì„ ë¹„í™œì„±í™”í•´ë„ ì´ ê°’ì€ í•„ìˆ˜ì…ë‹ˆë‹¤

#### Argo CD ìê²© ì¦ëª… ì‘ì„±

```bash
vi private/argocd-github.yaml
```

**ë‚´ìš© ì‘ì„±:**

```yaml
url: "https://github.com/YOUR-ORG-NAME"  # â† Organization URL
appId: "2858540"  # â† Argo CD Appì˜ App ID
installationId: "12345678"  # â† ìœ„ì—ì„œ í™•ì¸í•œ Installation ID
privateKey: |
  -----BEGIN RSA PRIVATE KEY-----
  ... (Argo CD Appì˜ .pem íŒŒì¼ ë‚´ìš©)
  ...
  -----END RSA PRIVATE KEY-----
```

#### íŒŒì¼ ê¶Œí•œ ì„¤ì • (ë³´ì•ˆ)

```bash
chmod 600 private/backstage-github.yaml
chmod 600 private/argocd-github.yaml

# gitignore í™•ì¸ (ì´ë¯¸ í¬í•¨ë˜ì–´ ìˆì–´ì•¼ í•¨)
grep "private/" .gitignore
```

---

## 4. AWS ì„¤ì •

### 4.1 config.yaml ì‘ì„±

Repository ë£¨íŠ¸ì˜ `config.yaml` íŒŒì¼ì„ ìˆ˜ì •í•©ë‹ˆë‹¤.

```bash
vi config.yaml
```

**ì˜ˆì‹œ ì„¤ì •:**

```yaml
repo:
  url: "https://github.com/YOUR-ORG/reference-implementation-aws"
  revision: "main"
  basepath: "packages"

cluster_name: "myapp-ref-impl"  # â† í´ëŸ¬ìŠ¤í„° ì´ë¦„ (kubernetes ì´ë¦„ ê·œì¹™ ì¤€ìˆ˜)
auto_mode: "false"              # â† EKS Auto Mode ì‚¬ìš© ì—¬ë¶€ (ì¼ë°˜ì ìœ¼ë¡œ false)
region: "ap-northeast-2"        # â† AWS ë¦¬ì „

domain: myapp.example.com       # â† ì‚¬ìš©í•  ë„ë©”ì¸
route53_hosted_zone_id: Z00297703HVW1L99K37IL  # â† Route53 Hosted Zone ID

path_routing: "true"            # â† Path ê¸°ë°˜ ë¼ìš°íŒ… (ê¶Œì¥)
                                # true: https://domain/argocd
                                # false: https://argocd.domain

tags:
  githubRepo: "github.com/YOUR-ORG/reference-implementation-aws"
  env: "dev"
  project: "myapp"
```

**ê°’ ì„¤ëª…:**

| íŒŒë¼ë¯¸í„° | ì„¤ëª… | ì˜ˆì‹œ |
|---------|------|------|
| `cluster_name` | EKS í´ëŸ¬ìŠ¤í„° ì´ë¦„ (ì†Œë¬¸ì, í•˜ì´í”ˆ ì‚¬ìš©) | `myapp-ref-impl` |
| `auto_mode` | EKS Auto Mode ì‚¬ìš© ì—¬ë¶€ (ê¸°ë³¸: false) | `"false"` |
| `region` | AWS ë¦¬ì „ | `ap-northeast-2` |
| `domain` | ì„œë¹„ìŠ¤ ì ‘ì† ë„ë©”ì¸ | `myapp.example.com` |
| `route53_hosted_zone_id` | Route53 Zone ID | `Z00297...` |
| `path_routing` | Path ê¸°ë°˜ ë¼ìš°íŒ… ì‚¬ìš© | `"true"` |

### 4.2 ClusterSecretStore ë¦¬ì „ ìˆ˜ì •

External Secrets Operatorê°€ AWS Secrets Managerì— ì ‘ê·¼í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ë¦¬ì „ì„ ì„¤ì •í•©ë‹ˆë‹¤.

```bash
# ë¦¬ì „ í™•ì¸
echo $AWS_REGION  # ë˜ëŠ” config.yamlì˜ region ê°’ ì‚¬ìš©

# ClusterSecretStore ë¦¬ì „ ìˆ˜ì •
sed -i.bak "s/us-west-2/$AWS_REGION/g" \
  packages/external-secrets/manifests/cluster-secret-store.yaml

# ë³€ê²½ í™•ì¸
grep "region:" packages/external-secrets/manifests/cluster-secret-store.yaml
# ì¶œë ¥: region: ap-northeast-2
```

### 4.3 AWS Secrets Managerì— ì„¤ì • ì €ì¥

ì„¤ì • íŒŒì¼ê³¼ GitHub App ìê²© ì¦ëª…ì„ AWS Secrets Managerì— ì €ì¥í•©ë‹ˆë‹¤.

```bash
# ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
./scripts/create-config-secrets.sh
```

**ì‹¤í–‰ ê³¼ì •:**

```
âœ¨ ========================================== âœ¨
ğŸ“¦       CNOE AWS Reference Implementation    ğŸ“¦
âœ¨ ========================================== âœ¨

ğŸ¯ Targets:
ğŸ”¶ AWS account number: 710232982381
ğŸ”¶ AWS profile (if set): your-project-name
ğŸ”¶ AWS region: ap-northeast-2
ğŸ”¶ Kubernetes cluster: myapp-ref-impl
ğŸ“‹ Configuration Details:
----------------------------------------------------
repo:
  url: "https://github.com/YOUR-ORG/reference-implementation-aws"
  ...
----------------------------------------------------

â“ Are you sure you want to continue?
```

**yes ì…ë ¥** â†’ 2ê°œì˜ Secret ìƒì„±:

1. **cnoe-ref-impl/config**: `config.yaml` ë‚´ìš©
2. **cnoe-ref-impl/github-app**: GitHub Apps ìê²© ì¦ëª…

**ê²€ì¦:**

```bash
# Secret ìƒì„± í™•ì¸
aws secretsmanager list-secrets \
  --region $AWS_REGION \
  --query 'SecretList[?contains(Name, `cnoe-ref-impl`)].Name'

# ì¶œë ¥:
# [
#     "cnoe-ref-impl/config",
#     "cnoe-ref-impl/github-app"
# ]

# Backstage webhookSecret ê°’ í™•ì¸
aws secretsmanager get-secret-value \
  --secret-id cnoe-ref-impl/github-app \
  --region $AWS_REGION \
  --query 'SecretString' --output text | \
  jq -r '.["backstage-github"].webhookSecret'

# ì¶œë ¥: dummy-webhook-secret-not-used  â† ì´ ê°’ì´ì–´ì•¼ í•¨!
```

---

## 5. ì„¤ì • íŒŒì¼ ì‘ì„±

ëª¨ë“  ì„¤ì •ì´ ì™„ë£Œë˜ì—ˆëŠ”ì§€ ìµœì¢… í™•ì¸í•©ë‹ˆë‹¤.

### 5.1 ì²´í¬ë¦¬ìŠ¤íŠ¸

```bash
# 1. config.yaml í™•ì¸
cat config.yaml | yq '.domain, .cluster_name, .region'

# 2. GitHub Apps ìê²© ì¦ëª… í™•ì¸
ls -l private/*.yaml
# -rw------- private/backstage-github.yaml
# -rw------- private/argocd-github.yaml

# 3. ClusterSecretStore ë¦¬ì „ í™•ì¸
grep "region:" packages/external-secrets/manifests/cluster-secret-store.yaml

# 4. AWS Secrets í™•ì¸
aws secretsmanager list-secrets \
  --region $AWS_REGION \
  --query 'SecretList[?contains(Name, `cnoe-ref-impl`)].Name'
```

### 5.2 Git Commit (ì„ íƒì‚¬í•­)

```bash
git add config.yaml
git add packages/external-secrets/manifests/cluster-secret-store.yaml
git commit -m "Configure for $(yq '.cluster_name' config.yaml)

- Set domain to $(yq '.domain' config.yaml)
- Update ClusterSecretStore region to $AWS_REGION

Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>"

# ì•„ì§ pushí•˜ì§€ ë§ˆì„¸ìš” (ì„¤ì¹˜ í›„ push)
```

---

## 6. EKS í´ëŸ¬ìŠ¤í„° ìƒì„±

### 6.1 í´ëŸ¬ìŠ¤í„° ìƒì„± ì‹œì‘

```bash
# í´ëŸ¬ìŠ¤í„° ìƒì„± ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
./scripts/create-cluster.sh
```

**ì„ íƒ:**

```
Select tool for creating cluster:
1) eksctl
2) terraform
Choose option (1 or 2): 1  â† eksctl ì„ íƒ
```

**ìƒì„± ê³¼ì •:**

```
Creating EKS Cluster using eksctl...
Creating cluster myapp-ref-impl in region ap-northeast-2...
This will take approximately 15-20 minutes.
```

### 6.2 í´ëŸ¬ìŠ¤í„° ìƒì„± ëª¨ë‹ˆí„°ë§

**ë³„ë„ í„°ë¯¸ë„ 1: CloudFormation ìŠ¤íƒ ìƒíƒœ**

```bash
watch -n 10 "aws cloudformation describe-stacks \
  --region $AWS_REGION \
  --stack-name eksctl-myapp-ref-impl-cluster \
  --query 'Stacks[0].StackStatus' \
  --output text"

# ì§„í–‰ ìƒíƒœ:
# CREATE_IN_PROGRESS â†’ CREATE_COMPLETE (ì•½ 15-20ë¶„)
```

**ë³„ë„ í„°ë¯¸ë„ 2: eksctl ë¡œê·¸ í™•ì¸**

```bash
tail -f ~/.eksctl/logs/*.log
```

### 6.3 í´ëŸ¬ìŠ¤í„° ìƒì„± ì™„ë£Œ í™•ì¸

```bash
# kubectl ì»¨í…ìŠ¤íŠ¸ í™•ì¸
kubectl config current-context
# ì¶œë ¥: your-user@myapp-ref-impl.ap-northeast-2.eksctl.io

# ë…¸ë“œ í™•ì¸
kubectl get nodes
# ì¶œë ¥: 4ê°œ ë…¸ë“œ Ready ìƒíƒœ

# ë„¤ì„ìŠ¤í˜ì´ìŠ¤ í™•ì¸
kubectl get ns
# kube-system, default ë“± ê¸°ë³¸ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì¡´ì¬

# IAM ì„œë¹„ìŠ¤ ì–´ì¹´ìš´íŠ¸ í™•ì¸
eksctl get iamserviceaccount --cluster myapp-ref-impl --region $AWS_REGION
# external-secrets, external-dns, crossplane ë“±ì˜ SA ìƒì„± í™•ì¸
```

---

## 7. í”Œë«í¼ ì„¤ì¹˜

### 7.1 ì„¤ì¹˜ ì‹œì‘

```bash
# ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
./scripts/install.sh
```

**ì‹¤í–‰ ê³¼ì •:**

```
âœ¨ ========================================== âœ¨
ğŸ“¦       CNOE AWS Reference Implementation    ğŸ“¦
âœ¨ ========================================== âœ¨

ğŸ¯ Targets:
ğŸ”¶ AWS account number: 710232982381
ğŸ”¶ AWS profile: your-project-name
ğŸ”¶ AWS region: ap-northeast-2
ğŸ”¶ Kubernetes cluster: myapp-ref-impl

ğŸ“‹ Configuration Details:
----------------------------------------------------
...
----------------------------------------------------

â“ Are you sure you want to continue with installation?
```

**yes ì…ë ¥** â†’ ì„¤ì¹˜ ì‹œì‘

### 7.2 ì„¤ì¹˜ ë‹¨ê³„

ìŠ¤í¬ë¦½íŠ¸ëŠ” ë‹¤ìŒ ìˆœì„œë¡œ ì„¤ì¹˜ë¥¼ ì§„í–‰í•©ë‹ˆë‹¤:

1. **Argo CD ì„¤ì¹˜** (Helm Chart)
2. **External Secrets Operator ì„¤ì¹˜** (Helm Chart)
3. **Addons ApplicationSet ìƒì„±**
4. **ëª¨ë“  Addon Applications ìë™ ìƒì„± ë° ë°°í¬**

### 7.3 ì„¤ì¹˜ ëª¨ë‹ˆí„°ë§

#### í„°ë¯¸ë„ 1: Applications ìƒíƒœ

```bash
watch -n 5 'kubectl get applications -n argocd -o custom-columns=NAME:.metadata.name,SYNC:.status.sync.status,HEALTH:.status.health.status'

# ì˜ˆìƒ ì¶œë ¥ (ìµœì¢…):
# NAME                                          SYNC        HEALTH
# addons-appset-pr-myapp-ref-impl              Synced      Healthy
# argo-workflows-myapp-ref-impl                Synced      Healthy
# argocd-myapp-ref-impl                        Synced      Healthy
# aws-load-balancer-controller-myapp-ref-impl  Synced      Healthy
# backstage-myapp-ref-impl                     Synced      Healthy
# cert-manager-myapp-ref-impl                  Synced      Healthy
# crossplane-compositions-myapp-ref-impl       Synced      Healthy
# crossplane-myapp-ref-impl                    Synced      Healthy
# crossplane-upbound-providers-myapp-ref-impl  OutOfSync   Healthy
# external-dns-myapp-ref-impl                  Synced      Healthy
# external-secrets-myapp-ref-impl              Synced      Healthy
# ingress-nginx-myapp-ref-impl                 Synced      Healthy
# keycloak-myapp-ref-impl                      Synced      Healthy
```

#### í„°ë¯¸ë„ 2: Pods ìƒíƒœ

```bash
watch -n 5 'kubectl get pods -A | grep -v "Running" | grep -v "Completed" | grep -v "NAMESPACE"'

# ëª¨ë“  Podì´ Running ë˜ëŠ” Completed ìƒíƒœì—¬ì•¼ í•¨
```

#### í„°ë¯¸ë„ 3: Argo CD UI (Port Forward)

```bash
# Admin ë¹„ë°€ë²ˆí˜¸ í™•ì¸
kubectl get secrets -n argocd argocd-initial-admin-secret \
  -oyaml | yq '.data.password' | base64 -d && echo

# Port Forward
kubectl port-forward -n argocd svc/argocd-server 8080:80

# ë¸Œë¼ìš°ì €ì—ì„œ ì ‘ì†: http://localhost:8080/argocd
# Username: admin
# Password: (ìœ„ì—ì„œ í™•ì¸í•œ ê°’)
```

### 7.4 ì„¤ì¹˜ ì™„ë£Œ í™•ì¸

#### ëª¨ë“  Applicationsê°€ Healthy ìƒíƒœì¸ì§€ í™•ì¸

```bash
kubectl get applications -n argocd -o json | \
  jq -r '.items[] | select(.status.health.status != "Healthy") | .metadata.name'

# ì¶œë ¥ ì—†ìŒ = ëª¨ë‘ Healthy âœ…
```

#### Ingress ìƒì„± í™•ì¸

```bash
kubectl get ingress -A

# ì˜ˆìƒ ì¶œë ¥:
# NAMESPACE   NAME                    HOSTS                   ADDRESS
# argo        argo-workflows-server   myapp.example.com       k8s-ingressn-xxx.elb.amazonaws.com
# argocd      argocd-server           myapp.example.com       k8s-ingressn-xxx.elb.amazonaws.com
# backstage   backstage               myapp.example.com       k8s-ingressn-xxx.elb.amazonaws.com
# keycloak    keycloak                myapp.example.com       k8s-ingressn-xxx.elb.amazonaws.com
```

#### SSL ì¸ì¦ì„œ ë°œê¸‰ í™•ì¸

```bash
kubectl get certificate -A

# ì˜ˆìƒ ì¶œë ¥:
# NAMESPACE   NAME                    READY   SECRET                  AGE
# argo        argo-workflows-tls      True    argo-workflows-tls      5m
# argocd      argocd-tls              True    argocd-tls              5m
# backstage   backstage-tls           True    backstage-tls           5m
# keycloak    keycloak-tls            True    keycloak-tls            5m
```

### 7.5 Git Push

ì´ì œ ì„¤ì •ì„ ì›ê²© ì €ì¥ì†Œì— pushí•©ë‹ˆë‹¤.

```bash
git push origin main
```

---

## 8. ì ‘ì† ë° í™•ì¸

### 8.1 DNS ì „íŒŒ ëŒ€ê¸°

```bash
# DNS ì „íŒŒ í™•ì¸ (A ë ˆì½”ë“œ)
dig myapp.example.com +short

# ALBì˜ IP ì£¼ì†Œê°€ ì¶œë ¥ë˜ë©´ ì „íŒŒ ì™„ë£Œ
# ì˜ˆ: 52.79.123.45, 13.124.234.56

# ë˜ëŠ” nslookup ì‚¬ìš©
nslookup myapp.example.com
```

> DNS ì „íŒŒëŠ” ë³´í†µ 1-5ë¶„ ì •ë„ ì†Œìš”ë©ë‹ˆë‹¤.

### 8.2 ì„œë¹„ìŠ¤ ì ‘ì† URL

Path Routing (`path_routing: "true"`) ì‚¬ìš© ì‹œ:

| ì„œë¹„ìŠ¤ | URL |
|--------|-----|
| **Backstage** | https://myapp.example.com/ |
| **Argo CD** | https://myapp.example.com/argocd |
| **Argo Workflows** | https://myapp.example.com/argo-workflows |
| **Keycloak** | https://myapp.example.com/keycloak/ |

Domain Routing (`path_routing: "false"`) ì‚¬ìš© ì‹œ:

| ì„œë¹„ìŠ¤ | URL |
|--------|-----|
| **Backstage** | https://backstage.myapp.example.com |
| **Argo CD** | https://argocd.myapp.example.com |
| **Argo Workflows** | https://argo-workflows.myapp.example.com |
| **Keycloak** | https://keycloak.myapp.example.com |

### 8.3 ë¡œê·¸ì¸ ì •ë³´

#### Argo CD

```bash
# Username
echo "admin"

# Password
kubectl get secrets -n argocd argocd-initial-admin-secret \
  -oyaml | yq '.data.password' | base64 -d && echo
```

#### Backstage / Argo Workflows / Keycloak (SSO)

```bash
# Username
echo "user1"

# Password
kubectl get secret -n keycloak keycloak-config \
  -o jsonpath='{.data.USER1_PASSWORD}' | base64 -d && echo
```

### 8.4 ì ‘ì† í…ŒìŠ¤íŠ¸

#### Backstage

1. https://myapp.example.com ì ‘ì†
2. `Sign In` í´ë¦­
3. Keycloak ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰ì…˜
4. Username: `user1`, Password: (ìœ„ì—ì„œ í™•ì¸)
5. ë¡œê·¸ì¸ ì„±ê³µ â†’ Backstage í™ˆ í™”ë©´

#### Argo CD

1. https://myapp.example.com/argocd ì ‘ì†
2. Username: `admin`, Password: (ìœ„ì—ì„œ í™•ì¸)
3. ë¡œê·¸ì¸ ì„±ê³µ â†’ 13ê°œ Applications í™•ì¸

---

## 9. íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### 9.1 Backstage Pod CrashLoopBackOff

#### ì¦ìƒ

```bash
kubectl get pods -n backstage
# NAME                        READY   STATUS             RESTARTS   AGE
# backstage-xxx-yyy           0/1     CrashLoopBackOff   5          10m
```

#### ë¡œê·¸ í™•ì¸

```bash
kubectl logs -n backstage -l app.kubernetes.io/name=backstage

# ì—ëŸ¬ ë©”ì‹œì§€:
# Missing required config value at 'integrations.github[0].apps[0].webhookSecret'
```

#### ì›ì¸

AWS Secrets Managerì˜ `webhookSecret` ê°’ì´ ë¹„ì–´ìˆê±°ë‚˜ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤.

#### í•´ê²° ë°©ë²•

```bash
# 1. AWS Secrets Manager ê°’ í™•ì¸
aws secretsmanager get-secret-value \
  --secret-id cnoe-ref-impl/github-app \
  --region $AWS_REGION \
  --query 'SecretString' --output text | \
  jq -r '.["backstage-github"].webhookSecret'

# 2. ë¹ˆ ë¬¸ìì—´ì´ë©´ ìˆ˜ì • í•„ìš”
vi private/backstage-github.yaml
# webhookSecret: "dummy-webhook-secret-not-used"  â† ì´ ê°’ìœ¼ë¡œ ìˆ˜ì •

# 3. AWS Secrets Manager ì—…ë°ì´íŠ¸
./scripts/create-config-secrets.sh

# 4. K8s Secret ê°•ì œ ë™ê¸°í™”
kubectl delete secret integrations -n backstage

# 5. Pod ì¬ì‹œì‘
kubectl delete pod -n backstage -l app.kubernetes.io/name=backstage

# 6. í™•ì¸
kubectl get pods -n backstage
# NAME                        READY   STATUS    RESTARTS   AGE
# backstage-xxx-yyy           1/1     Running   0          30s
```

### 9.2 ExternalSecrets ë™ê¸°í™” ì‹¤íŒ¨

#### ì¦ìƒ

```bash
kubectl get externalsecret -A

# NAME               STORE                REFRESH INTERVAL   STATUS        READY
# integrations       aws-secretsmanager   0                  SecretSyncedError   False
```

#### ì›ì¸ 1: ClusterSecretStore ë¦¬ì „ ë¶ˆì¼ì¹˜

```bash
# í˜„ì¬ ë¦¬ì „ í™•ì¸
kubectl get clustersecretstore aws-secretsmanager \
  -o jsonpath='{.spec.provider.aws.region}'

# us-west-2ë¡œ ë˜ì–´ ìˆìœ¼ë©´ ìˆ˜ì • í•„ìš”
```

#### í•´ê²° ë°©ë²•

```bash
# 1. ClusterSecretStore ë¦¬ì „ ìˆ˜ì •
kubectl patch clustersecretstore aws-secretsmanager \
  --type='json' \
  -p="[{\"op\": \"replace\", \"path\": \"/spec/provider/aws/region\", \"value\":\"$AWS_REGION\"}]"

# 2. External Secrets Operator ì¬ì‹œì‘
kubectl rollout restart deployment external-secrets -n external-secrets

# 3. ExternalSecrets ì¬ë™ê¸°í™”
kubectl annotate externalsecret -A --all force-sync=$(date +%s) --overwrite

# 4. í™•ì¸
kubectl get externalsecret -A
```

#### ì›ì¸ 2: IAM ê¶Œí•œ ë¶€ì¡±

```bash
# External Secrets SAì˜ IAM Role í™•ì¸
kubectl get sa external-secrets -n external-secrets -o yaml | grep eks.amazonaws.com/role-arn

# ë¡œê·¸ í™•ì¸
kubectl logs -n external-secrets deployment/external-secrets | tail -50
```

#### í•´ê²° ë°©ë²•

```bash
# Pod Identity Association ì¬ìƒì„±
eksctl utils associate-iam-oidc-provider \
  --cluster myapp-ref-impl \
  --region $AWS_REGION \
  --approve

# ë˜ëŠ” í´ëŸ¬ìŠ¤í„° ì¬ìƒì„±
```

### 9.3 Ingress ALB ìƒì„± ì•ˆë¨

#### ì¦ìƒ

```bash
kubectl get ingress -A

# ADDRESS ì»¬ëŸ¼ì´ ë¹„ì–´ìˆìŒ
```

#### ì›ì¸

AWS Load Balancer Controllerê°€ ì •ìƒ ë™ì‘í•˜ì§€ ì•ŠìŒ

#### í•´ê²° ë°©ë²•

```bash
# 1. LB Controller ìƒíƒœ í™•ì¸
kubectl get pods -n kube-system -l app.kubernetes.io/name=aws-load-balancer-controller

# 2. ë¡œê·¸ í™•ì¸
kubectl logs -n kube-system -l app.kubernetes.io/name=aws-load-balancer-controller

# 3. Ingress Class í™•ì¸
kubectl get ingressclass
# NAME    CONTROLLER             PARAMETERS   AGE
# nginx   k8s.io/ingress-nginx   <none>       10m

# 4. Ingress ì¬ìƒì„±
kubectl delete ingress -A --all
kubectl delete application -n argocd ingress-nginx-myapp-ref-impl
# Argo CDê°€ ìë™ìœ¼ë¡œ ì¬ìƒì„±
```

### 9.4 Certificate ë°œê¸‰ ì‹¤íŒ¨

#### ì¦ìƒ

```bash
kubectl get certificate -A

# READYê°€ False ìƒíƒœë¡œ ìœ ì§€
```

#### ë¡œê·¸ í™•ì¸

```bash
# Cert-Manager ë¡œê·¸
kubectl logs -n cert-manager deployment/cert-manager

# Certificate ìƒì„¸ ì •ë³´
kubectl describe certificate -n backstage backstage-tls
```

#### ì›ì¸ & í•´ê²°

**1. DNS ì „íŒŒ ë¯¸ì™„ë£Œ**

```bash
# DNS ì „íŒŒ í™•ì¸
dig myapp.example.com +short

# Let's Encryptê°€ ë„ë©”ì¸ì„ í™•ì¸í•  ìˆ˜ ìˆì„ ë•Œê¹Œì§€ ëŒ€ê¸° (1-5ë¶„)
```

**2. Rate Limit (Let's Encrypt)**

```bash
# Staging issuerë¡œ í…ŒìŠ¤íŠ¸
kubectl patch certificate -n backstage backstage-tls \
  --type='json' \
  -p='[{"op": "replace", "path": "/spec/issuerRef/name", "value":"letsencrypt-staging"}]'

# 5ë¶„ ëŒ€ê¸° í›„ productionìœ¼ë¡œ ë³€ê²½
```

### 9.5 Keycloak Pod ì´ë¯¸ì§€ Pull ì‹¤íŒ¨

#### ì¦ìƒ

```bash
kubectl get pods -n keycloak

# NAME                        READY   STATUS         RESTARTS   AGE
# keycloak-0                  0/1     ErrImagePull   0          5m
```

#### ë¡œê·¸ í™•ì¸

```bash
kubectl describe pod -n keycloak keycloak-0

# Events:
#   Failed to pull image "docker.io/bitnami/keycloak:latest":
#   manifest unknown
```

#### ì›ì¸

Bitnamiê°€ ë ˆê±°ì‹œ ì´ë¯¸ì§€ë¥¼ ë³„ë„ ë ˆì§€ìŠ¤íŠ¸ë¦¬ë¡œ ì´ë™

#### í•´ê²° ë°©ë²•

ì´ë¯¸ packages/keycloak/values.yamlì— ìˆ˜ì •ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤:

```yaml
image:
  registry: docker.io
  repository: bitnamilegacy/keycloak  # â† bitnami â†’ bitnamilegacy
  tag: latest

postgresql:
  image:
    registry: docker.io
    repository: bitnamilegacy/postgresql  # â† bitnami â†’ bitnamilegacy
    tag: latest
```

ë§Œì•½ ìˆ˜ì •ë˜ì§€ ì•Šì•˜ë‹¤ë©´:

```bash
# values.yaml ìˆ˜ì •
sed -i 's|repository: bitnami/|repository: bitnamilegacy/|g' \
  packages/keycloak/values.yaml \
  packages/backstage/values.yaml

# Git commit & push
git add packages/*/values.yaml
git commit -m "Fix: Use bitnamilegacy registry for Keycloak and PostgreSQL"
git push origin main

# Argo CD ë™ê¸°í™” (ìë™ ë˜ëŠ” ìˆ˜ë™)
kubectl delete application -n argocd keycloak-myapp-ref-impl backstage-myapp-ref-impl
```

### 9.6 ì¼ë°˜ì ì¸ ë””ë²„ê¹… ëª…ë ¹ì–´

```bash
# ì „ì²´ ë¦¬ì†ŒìŠ¤ ìƒíƒœ í™•ì¸
kubectl get all -A

# íŠ¹ì • ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì˜ ì´ë²¤íŠ¸ í™•ì¸
kubectl get events -n backstage --sort-by='.lastTimestamp'

# Pod ë¡œê·¸ ì‹¤ì‹œê°„ í™•ì¸
kubectl logs -f -n backstage deployment/backstage

# Pod ë‚´ë¶€ ì ‘ì†
kubectl exec -it -n backstage deployment/backstage -- /bin/sh

# Argo CDì—ì„œ Application ìƒì„¸ ì •ë³´
kubectl describe application -n argocd backstage-myapp-ref-impl

# ExternalSecret ìƒì„¸ ì •ë³´
kubectl describe externalsecret -n backstage integrations
```

---

## 10. ìš´ì˜ ê°€ì´ë“œ

### 10.1 ì„¤ì • ë³€ê²½

#### config.yaml ì—…ë°ì´íŠ¸

```bash
# 1. config.yaml ìˆ˜ì •
vi config.yaml

# 2. AWS Secrets Manager ì—…ë°ì´íŠ¸
./scripts/create-config-secrets.sh

# 3. Git commit & push
git add config.yaml
git commit -m "Update configuration"
git push origin main

# 4. ì˜í–¥ë°›ëŠ” Applications ì¬ì‹œì‘
kubectl delete pod -n argocd -l app.kubernetes.io/name=argocd-repo-server
```

#### GitHub Apps ìê²© ì¦ëª… ë³€ê²½

```bash
# 1. private/*.yaml ìˆ˜ì •
vi private/backstage-github.yaml

# 2. AWS Secrets Manager ì—…ë°ì´íŠ¸
./scripts/create-config-secrets.sh

# 3. Kubernetes Secrets ê°•ì œ ë™ê¸°í™”
kubectl delete secret integrations -n backstage
kubectl delete secret repo-github-app -n argocd

# 4. Pods ì¬ì‹œì‘
kubectl delete pod -n backstage -l app.kubernetes.io/name=backstage
kubectl delete pod -n argocd -l app.kubernetes.io/name=argocd-repo-server
```

### 10.2 ì• í”Œë¦¬ì¼€ì´ì…˜ ì¶”ê°€/ì œê±°

#### Backstageì—ì„œ ìƒˆ ì•± ìƒì„±

1. Backstage ì ‘ì†
2. `CREATE...` ë²„íŠ¼ í´ë¦­
3. í…œí”Œë¦¿ ì„ íƒ (ì˜ˆ: Basic App)
4. ì •ë³´ ì…ë ¥ â†’ Create

Argo CDê°€ ìë™ìœ¼ë¡œ ìƒˆ Applicationì„ ìƒì„±í•˜ê³  ë°°í¬í•©ë‹ˆë‹¤.

### 10.3 ë°±ì—… ë° ë³µêµ¬

#### ì¤‘ìš” ë°ì´í„°

- **AWS Secrets Manager**: `cnoe-ref-impl/config`, `cnoe-ref-impl/github-app`
- **private/ ë””ë ‰í† ë¦¬**: GitHub Apps ìê²© ì¦ëª…
- **config.yaml**: ì„¤ì¹˜ ì„¤ì •

```bash
# ë°±ì—…
aws secretsmanager get-secret-value --secret-id cnoe-ref-impl/config \
  --region $AWS_REGION --output json > backup-config.json

aws secretsmanager get-secret-value --secret-id cnoe-ref-impl/github-app \
  --region $AWS_REGION --output json > backup-github-app.json
```

### 10.4 ëª¨ë‹ˆí„°ë§

```bash
# Applications ìƒíƒœ í™•ì¸
kubectl get applications -n argocd

# ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ í™•ì¸
kubectl top nodes
kubectl top pods -A

# ì£¼ìš” ì„œë¹„ìŠ¤ Pod ìƒíƒœ
kubectl get pods -n backstage -n keycloak -n argocd -n argo
```

### 10.5 í´ë¦°ì—…

#### ì• í”Œë¦¬ì¼€ì´ì…˜ë§Œ ì œê±° (í´ëŸ¬ìŠ¤í„° ìœ ì§€)

```bash
./scripts/uninstall.sh
```

#### CRDs ì œê±°

```bash
./scripts/cleanup-crds.sh
```

#### í´ëŸ¬ìŠ¤í„° ì „ì²´ ì‚­ì œ

```bash
# eksctlë¡œ ìƒì„±í•œ ê²½ìš°
eksctl delete cluster --name myapp-ref-impl --region $AWS_REGION

# terraformìœ¼ë¡œ ìƒì„±í•œ ê²½ìš°
cd cluster/terraform
terraform destroy
```

---

## ğŸ‰ ì™„ë£Œ!

ì´ì œ ì™„ì „íˆ ê¸°ëŠ¥í•˜ëŠ” Internal Developer Platformì´ êµ¬ì¶•ë˜ì—ˆìŠµë‹ˆë‹¤!

### ë‹¤ìŒ ë‹¨ê³„

1. **Backstage íƒìƒ‰**: í…œí”Œë¦¿ìœ¼ë¡œ ì²« ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒì„±
2. **Argo CD í•™ìŠµ**: GitOps ì›Œí¬í”Œë¡œìš° ì´í•´
3. **Crossplane í™œìš©**: AWS ë¦¬ì†ŒìŠ¤ë¥¼ ì½”ë“œë¡œ í”„ë¡œë¹„ì €ë‹
4. **Argo Workflows**: CI/CD íŒŒì´í”„ë¼ì¸ êµ¬ì¶•

### ì¶”ê°€ ë¦¬ì†ŒìŠ¤

- [Backstage ê³µì‹ ë¬¸ì„œ](https://backstage.io/docs)
- [Argo CD ê³µì‹ ë¬¸ì„œ](https://argo-cd.readthedocs.io/)
- [Crossplane ê°€ì´ë“œ](https://docs.crossplane.io/)
- [External Secrets Operator](https://external-secrets.io/)

---

**ë¬¸ì˜ì‚¬í•­ì´ë‚˜ í”¼ë“œë°±ì€ GitHub Issuesë¥¼ í†µí•´ ë‚¨ê²¨ì£¼ì„¸ìš”!** ğŸš€
